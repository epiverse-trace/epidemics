<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reducing parameters required for final size estimation • epidemics</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reducing parameters required for final size estimation">
<meta name="robots" content="noindex">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">epidemics</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/epidemics.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling interventions</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_interventions.html">Getting started with modelling interventions targeting social contacts</a></li>
    <li><a class="dropdown-item" href="../articles/modelling_multiple_interventions.html">Modelling overlapping and sequential interventions targeting social contacts</a></li>
    <li><a class="dropdown-item" href="../articles/modelling_rate_interventions.html">Modelling interventions that change infection parameters</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling vaccination</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_vaccination.html">Modelling the effect of a vaccination campaign</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling seasonality</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_time_dependence.html">Modelling time-dependence and seasonality in transmission dynamics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Run models with multiple populations</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_populations.html">Modelling in multiple populations</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced modelling</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_param_uncertainty.html">Modelling parameter uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/modelling_scenarios.html">Modelling intervention scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/finalsize_comparison.html">Reducing parameters required for final size estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides to library models</h6></li>
    <li><a class="dropdown-item" href="../articles/model_vacamole.html">Modelling leaky vaccination and hospitalisation outcomes with Vacamole</a></li>
    <li><a class="dropdown-item" href="../articles/model_ebola.html">Modelling responses to a stochastic Ebola virus epidemic</a></li>
    <li><a class="dropdown-item" href="../articles/model_diphtheria.html">Modelling a diphtheria outbreak in a humanitarian camp setting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides for developers</h6></li>
    <li><a class="dropdown-item" href="../articles/design-principles.html">Design principles for epidemics</a></li>
    <li><a class="dropdown-item" href="../articles/developer-walkthrough.html">Guide to developing epidemics features</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/epidemics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Reducing parameters required for final size estimation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/epidemics/blob/main/vignettes/finalsize_comparison.Rmd" class="external-link"><code>vignettes/finalsize_comparison.Rmd</code></a></small>
      <div class="d-none name"><code>finalsize_comparison.Rmd</code></div>
    </div>

    
    
<div class="alert alert-warning">
<p><strong>New to <em>epidemics</em>?</strong> It may help to read the
<a href="epidemics.html">“Get started”</a> vignette first!</p>
<p>Additionally, read how to quickly <a href="https://epiverse-trace.github.io/finalsize/" class="external-link">calculate the final
size of an epidemic</a> - with fewer epidemiological inputs than
<em>epidemics</em> required - the <em>finalsize</em> package, which uses
an analytical solution to avoid simulating the full epidemic
dynamics.</p>
</div>
<p>The total number of individuals expected to have been infected over
an epidemic is called the epidemic final size <span class="citation">(<a href="#ref-miller2012">Miller 2012</a>)</span>. The R package <a href="https://cran.r-project.org/package=finalsize" class="external-link"><em>finalsize</em></a>
can help to calculate the epidemic final sizes using the final size
equation <span class="citation">(<a href="#ref-miller2012">Miller
2012</a>)</span>, while accounting for heterogeneity in population
contacts as well as susceptibility to infection, such as due to
vaccination.</p>
<p><em>epidemics</em> can also be used to calculate the final size of an
outbreak while accounting for heterogeneity in contacts and the rollout
of vaccination campaigns.</p>
<p>This vignette lays out which of the two is more suitable for specific
tasks, and how to convert between when seeking more insight into the
effect of policy decisions made during epidemic response.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/epidemics" class="external-link">epidemics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/finalsize" class="external-link">finalsize</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bench.r-lib.org/" class="external-link">bench</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="different-use-cases-of-finalsize-and-epidemics">Different use cases of <em>finalsize</em> and
<em>epidemics</em><a class="anchor" aria-label="anchor" href="#different-use-cases-of-finalsize-and-epidemics"></a>
</h2>
<p>While both <em>finalsize</em> and <em>epidemics</em> can be used to
calculate the epidemic final size, they are aimed at different use
cases.</p>
<p><strong><em>finalsize</em></strong> assumes that both infection and
population characteristics are fixed to their initial conditions. For
the infection, this includes properties such as the transmission rate,
while for the population, it includes social contacts between
demographic groups, and the proportion of demographic groups that have
specific levels of susceptibility to infection.</p>
<p>An advantage is that <em>finalsize</em> only requires that we define
the initial transmission rate of the infection and susceptibility of the
population, rather than all the time-dependent processes that drive the
epidemic shape, such as the duration of infectiousness or latent period
of the infection. For questions relating to epidemic shape, rather than
shape, this results in a much simpler set of inputs.</p>
<p>However, it also means that <em>finalsize</em> cannot be used to
model temporal dynamics of epidemic response, or be used to answer
policy questions with a temporal component, such as when to implement
interventions.</p>
<p><strong><em>epidemics</em></strong> includes a number of scenario
models, each with its own assumptions. Most models allow for some
modification of the initial characteristics of the outbreak due to a
range of events. For the infection, this includes interventions (such as
masking or treatments) that reduce the number of forward transmissions
or deaths, but also seasonal effects which may increase or decrease the
transmission rate. For the population, initial conditions of social
contacts can be influenced by interventions as well.</p>
<p>This makes it much easier to model the temporal dynamics of
public-health policy decisions which are taken during epidemic response
as <em>epidemics</em> has many more features that allow for such
modelling.</p>
<p>However, it requires more inputs to be defined, including
time-dependent infections processes. It can also be more difficult to
model scenarios in which more complicated susceptibility structure is
required, such as when some demographic groups have underlying immunity
to infection due to past exposure or vaccination. Thus
<em>epidemics</em> is likely to be especially useful for outbreaks of
novel pathogens (such as the Covid-19 pandemic) where there is little
population immunity to infection.</p>
<p>It is easier to configure <em>finalsize</em> out-of-the-box for
scenarios with complex demographic patterns of underlying susceptibility
to (or immunity against) infection, potentially due to a history of
previous outbreaks and the policy responses (such as vaccination). Thus,
while it cannot model temporal dynamics, it can quickly provide useful
initial estimates of the final size of outbreaks, without having to
write compartmental models which implement multiple policy
decisions.</p>
</div>
<div class="section level2">
<h2 id="converting-scenarios-between-finalsize-and-epidemics">Converting scenarios between <em>finalsize</em> and
<em>epidemics</em><a class="anchor" aria-label="anchor" href="#converting-scenarios-between-finalsize-and-epidemics"></a>
</h2>
<p>Here, we show an example in which we show how to model a similar
scenario using both <em>finalsize</em> and <em>epidemics</em>. For
example, we might want to study the full epidemic dynamics in future,
but start with a simpler final size estimate in the meantime. Here we
show how to build equivalent models, while allowing extensions to model
epidemic temporal dynamics (using <em>epidemics</em>) later.</p>
<p>As an illustration, we use <em>epidemics</em> to model the effect of
vaccination on the trajectory of an epidemic. While <em>finalsize</em>
does not allow for the implementation of a <em>dynamic</em> vaccination
calendar, we can model reduced susceptibility to infection in the
population, such as due to prior vaccination.</p>
<p>The two methods are comparable if we model vaccination in
<em>epidemics</em> as occurring before the main wave of the epidemic, as
this sets up underlying susceptibility.</p>
<div class="section level3">
<h3 id="prepare-population-and-model-parameters">Prepare population and model parameters<a class="anchor" aria-label="anchor" href="#prepare-population-and-model-parameters"></a>
</h3>
<p>We first prepare the population (modelled on the U.K.), initial
conditions, and model parameters, before passing them to
<code><a href="../reference/model_default.html">epidemics::model_default()</a></code>. This example does not include
any interventions or vaccination regimes.</p>
<p>Code to prepare model inputs is folded below for brevity. See the <a href="epidemics.html">“Get started”</a> vignette for an explanation of
how to prepare these inputs.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load contact and population data from socialmixr::polymod</span></span>
<span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="va">polymod</span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">contact_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare contact matrix</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare the demography vector</span></span>
<span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initial conditions: one in every 1 million is infected</span></span>
<span><span class="va">initial_i</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">initial_i</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="va">initial_i</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build for all age groups</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">initial_conditions</span>,</span>
<span>  <span class="va">initial_conditions</span>,</span>
<span>  <span class="va">initial_conditions</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">initial_conditions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare the population to model as affected by the epidemic</span></span>
<span><span class="co"># the contact_matrix, demography_vector, and initial_conditions</span></span>
<span><span class="co"># have been prepared in the folded code above</span></span>
<span><span class="va">uk_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"UK"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view the population</span></span>
<span><span class="va">uk_population</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #0000BB;">Population name: </span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #0000BB;">Demography</span> </span></span>
<span><span class="co">#&gt; [0,20): 14,799,290 (20%)</span></span>
<span><span class="co">#&gt; [20,40): 16,526,302 (30%)</span></span>
<span><span class="co">#&gt; 40+: 28,961,159 (50%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #0000BB;">Contact matrix</span> </span></span>
<span><span class="co">#&gt;                  age.group</span></span>
<span><span class="co">#&gt; contact.age.group   [0,20)  [20,40)      40+</span></span>
<span><span class="co">#&gt;           [0,20)  7.883663 2.794154 1.565665</span></span>
<span><span class="co">#&gt;           [20,40) 3.120220 4.854839 2.624868</span></span>
<span><span class="co">#&gt;           40+     3.063895 4.599893 5.005571</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  <span style="color: #0000BB;">Initial Conditions</span> </span></span>
<span><span class="co">#&gt;                S E     I R V</span></span>
<span><span class="co">#&gt; [0,20)  0.999999 0 1e-06 0 0</span></span>
<span><span class="co">#&gt; [20,40) 0.999999 0 1e-06 0 0</span></span>
<span><span class="co">#&gt; 40+     0.999999 0 1e-06 0 0</span></span></code></pre></div>
<p>We model the spread of influenza with pandemic potential, assuming
$R_0 = $ 1.5, a pre-infectious period of 3 days, and an infectious
period of 7 days.</p>
<p>This leads to the following model parameters for transmission rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>,
the rate of transition from exposed to infectious
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
and the recovery rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate pandemic parameters</span></span>
<span><span class="va">transmission_rate</span> <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="op">/</span> <span class="fl">7</span></span>
<span><span class="va">infectiousness_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span></span>
<span><span class="va">recovery_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">7</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="implementing-vaccination-in-epidemics">Implementing vaccination in <em>epidemics</em><a class="anchor" aria-label="anchor" href="#implementing-vaccination-in-epidemics"></a>
</h3>
<p>For simplicity, we implement a vaccination regime in which vaccines
are delivered to individuals over the age of 40 over the course of
roughly six months (150 days) before the main epidemic peak. We assume
that 1 in every 1000 individuals in this age group is vaccinated every
day; this translates to approximately 28,900 individuals per day.</p>
<p>We assume that the vaccination is non-leaky, protecting vaccinated
individuals from infection, and this due to the model structure of the
‘default’ SEIR-V model in <em>epidemics</em> that we use here.</p>
<div class="alert alert-info">
<p><strong>New to modelling vaccination using
<em>epidemics</em>?</strong> It may help to read the <a href="modelling_vaccination.html">“Modelling a vaccination campaign”</a>
vignette first.</p>
</div>
<p>We first create a <code>&lt;vaccination&gt;</code> object to
represent this vaccination regime.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare a vaccination object</span></span>
<span><span class="va">vaccinate_elders</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vaccination.html">vaccination</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"vaccinate elders"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We then pass this vaccination regime to the epidemic function in the
optional <code>vaccination</code> argument, and model 600 days of the
epidemic. We obtain the ‘final’ epidemic size using
<code><a href="../reference/epidemic_size.html">epidemics::epidemic_size()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># model epidemic with vaccination prior to the main epidemic wave</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_default.html">model_default</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>  infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>  recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>  vaccination <span class="op">=</span> <span class="va">vaccinate_elders</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">600</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the epidemic size using the helper function</span></span>
<span><span class="va">finalsize_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  demography_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="../reference/epidemic_size.html">epidemic_size</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">/</span> <span class="va">demography_vector</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the data</span></span>
<span><span class="va">finalsize_dat</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   demography_group value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> [0,20)           0.617</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> [20,40)          0.525</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 40+              0.343</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-individuals-vaccinated-in-epidemic-model">Calculating individuals vaccinated in epidemic model<a class="anchor" aria-label="anchor" href="#calculating-individuals-vaccinated-in-epidemic-model"></a>
</h3>
<p>To compare the results of the ODE model against the analytical
method, it is necessary to set up the population’s susceptibility and
demography-in-susceptibility matrices to reflect the proportion of
individuals in each age group vaccinated before the outbreak.</p>
<p>To do this, we need to calculate the total proportion of individuals
in each age group vaccinated at the end of the epidemic model run.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Proportion of the individuals vaccinated</span></span>
<span><span class="va">p_vacc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">compartment</span> <span class="op">==</span> <span class="st">"vaccinated"</span>, <span class="va">time</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_vacc</span> <span class="op">&lt;-</span> <span class="va">p_vacc</span><span class="op">$</span><span class="va">value</span> <span class="op">/</span> <span class="va">demography_vector</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="implementing-vaccination-in-finalsize">Implementing vaccination in <em>finalsize</em><a class="anchor" aria-label="anchor" href="#implementing-vaccination-in-finalsize"></a>
</h3>
<p>We use the proportion of individuals vaccinated in each age group to
set up matrices to pass to the <code>susceptibility</code> and
<code>p_susceptibility</code> arguments of
<code><a href="https://epiverse-trace.github.io/finalsize/reference/final_size.html" class="external-link">finalsize::final_size()</a></code>.</p>
<div class="alert alert-info">
<p><strong>New to final size estimation with heterogeneity in
susceptibility to infection?</strong> It may help to read the <a href="https://epiverse-trace.github.io/finalsize/articles/varying_susceptibility.html" class="external-link">“Modelling
heterogeneous susceptibility” vignette</a>, and the <a href="https://epiverse-trace.github.io/finalsize/articles/susceptibility_matrices.html" class="external-link">“Guide
to constructing susceptibility matrices”</a> for <em>finalsize</em>
first.</p>
</div>
<p>We create the susceptibility matrix to have two groups,
‘unvaccinated’, with full susceptibility, and ‘vaccinated’, who are
immune to infection.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create the susceptibility matrix</span></span>
<span><span class="va">susceptibility</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unvaccinated"</span>, <span class="st">"vaccinated"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We then create the demography-in-susceptibility matrix to reflect
that only some individuals in the &gt;40 age group are vaccinated. Since
vaccination has not been implemented for other age groups, we assume
that all individuals in those groups are fully susceptible.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Second column holds the vaccinated (who are protected fully)</span></span>
<span><span class="va">susceptibility</span><span class="op">[</span>, <span class="st">"vaccinated"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Assume susceptibility varies within age groups</span></span>
<span><span class="va">p_susceptibility</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unvaccinated"</span>, <span class="st">"vaccinated"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p_susceptibility</span><span class="op">[</span>, <span class="st">"vaccinated"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_vacc</span></span>
<span><span class="va">p_susceptibility</span><span class="op">[</span>, <span class="st">"unvaccinated"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">p_vacc</span></span></code></pre></div>
<p>We then calculate the expected final size using the modified
susceptibility matrices, and combine this data with the output of the
ODE model as in the previous example.</p>
<p>We need to scale the contact matrix appropriately.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define population in each age group</span></span>
<span><span class="va">scalar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span> <span class="op">/</span> <span class="va">demography_vector</span><span class="op">)</span> <span class="op">/</span> <span class="va">scalar</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the proportion of individuals infected in each age group</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://epiverse-trace.github.io/finalsize/reference/final_size.html" class="external-link">final_size</a></span><span class="op">(</span></span>
<span>  r0 <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  susceptibility <span class="op">=</span> <span class="va">susceptibility</span>,</span>
<span>  p_susceptibility <span class="op">=</span> <span class="va">p_susceptibility</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Final size returns the proportion infected in each susceptibility group</span></span>
<span><span class="co"># (i.e. non vaccinated and vaccinated)</span></span>
<span><span class="co"># here we calculate the proportion of infected for the age group as a whole</span></span>
<span><span class="va">dat3</span> <span class="op">&lt;-</span> <span class="va">dat1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="va">susceptibility</span>,</span>
<span>    final_size <span class="op">=</span> <span class="va">p_infected</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">susc_grp</span> <span class="op">==</span> <span class="st">"unvaccinated"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">susc_grp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="va">dat3</span><span class="op">$</span><span class="va">unvaccinated</span> <span class="op">*</span> <span class="va">p_susceptibility</span><span class="op">[</span>, <span class="st">"unvaccinated"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">finalsize_dat</span> <span class="op">&lt;-</span> <span class="va">finalsize_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>demo_grp <span class="op">=</span> <span class="va">demography_group</span>, seir_v <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dat3</span><span class="op">)</span></span></code></pre></div>
<p>We can print the data to compare values, which are similar.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">finalsize_dat</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   demo_grp seir_v final_size</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> [0,20)    0.617      0.660</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> [20,40)   0.525      0.543</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 40+       0.343      0.272</span></span></code></pre></div>
<p>However, note that while <code><a href="../reference/epidemic_size.html">epidemics::epidemic_size()</a></code> can
be used for any time point in the epidemic,
<code><a href="https://epiverse-trace.github.io/finalsize/reference/final_size.html" class="external-link">finalsize::final_size()</a></code> only returns the size at the end of
the epidemic, showing how <em>epidemics</em> is more suitable to examine
temporal dynamics.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note that epidemic_size() returns the absolute values</span></span>
<span><span class="co"># epidemic size after 10% of the epidemic model run</span></span>
<span><span class="fu"><a href="../reference/epidemic_size.html">epidemic_size</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">output</span>, stage <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 574.5195 488.4438 585.7900</span></span>
<span></span>
<span><span class="co"># epidemic size at 50%</span></span>
<span><span class="fu"><a href="../reference/epidemic_size.html">epidemic_size</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">output</span>, stage <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5569912 4894521 5262117</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="consideration-of-computational-speed">Consideration of computational speed<a class="anchor" aria-label="anchor" href="#consideration-of-computational-speed"></a>
</h2>
<p>An important reason to use <em>finalsize</em> for final size
calculations may be speed — <code><a href="https://epiverse-trace.github.io/finalsize/reference/final_size.html" class="external-link">finalsize::final_size()</a></code> is much
faster than <code><a href="../reference/epidemic_size.html">epidemics::epidemic_size()</a></code> applied to
<code><a href="../reference/model_default.html">epidemics::model_default()</a></code>. This makes it much more
suitable for high-performance applications such as fitting to data.</p>
<p>The benchmarking shows that the total time taken for 1,000 runs using
both methods is very low, and both methods could be used to scan across
multiple values of the input parameters, such as when dealing with
parameter uncertainty.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run benchmarks using {bench}</span></span>
<span><span class="va">benchmark</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  analytical_method <span class="op">=</span> <span class="fu"><a href="https://epiverse-trace.github.io/finalsize/reference/final_size.html" class="external-link">final_size</a></span><span class="op">(</span></span>
<span>    r0 <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>    demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>    susceptibility <span class="op">=</span> <span class="va">susceptibility</span>,</span>
<span>    p_susceptibility <span class="op">=</span> <span class="va">p_susceptibility</span></span>
<span>  <span class="op">)</span>,</span>
<span>  ode_model <span class="op">=</span> <span class="fu"><a href="../reference/epidemic_size.html">epidemic_size</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/model_default.html">model_default</a></span><span class="op">(</span></span>
<span>      population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>      transmission_rate <span class="op">=</span> <span class="va">transmission_rate</span>,</span>
<span>      infectiousness_rate <span class="op">=</span> <span class="va">infectiousness_rate</span>,</span>
<span>      recovery_rate <span class="op">=</span> <span class="va">recovery_rate</span>,</span>
<span>      vaccination <span class="op">=</span> <span class="va">vaccinate_elders</span>,</span>
<span>      time_end <span class="op">=</span> <span class="fl">600</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="st">"s"</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view the total time for 1000 runs in seconds</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">benchmark</span><span class="op">)</span>, <span class="va">expression</span>, <span class="va">total_time</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   expression        total_time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> analytical_method      0.468</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ode_model             10.1</span></span></code></pre></div>
<p><strong>Note</strong> that some model runs using <em>epidemics</em>
that implement more complex compartmental structure, or multiple
interventions and vaccination regimes are likely to be slower than the
example shown here.</p>
<p>However, users should choose <em>finalsize</em> only when the
assumptions underlying a final size calculation are met. For example, in
cases where vaccinations are concurrent with a large number of
infections, or when interventions are applied to reduce transmission,
the final size assumptions are not met. In these cases, users are
advised to use a dynamical model such as those in <em>epidemics</em>
instead.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-miller2012" class="csl-entry">
Miller, Joel C. 2012. <span>“A Note on the Derivation of Epidemic Final
Sizes.”</span> <em>Bulletin of Mathematical Biology</em> 74 (9):
2125–41. <a href="https://doi.org/10.1007/s11538-012-9749-6" class="external-link">https://doi.org/10.1007/s11538-012-9749-6</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pratik Gupte, Rosalind Eggo, Edwin Van Leeuwen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3. Theme provided by <a href="https://github.com/epiverse-trace/epiversetheme" class="external-link">epiversetheme</a> 0.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
