<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modelling in multiple populations • epidemics</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modelling in multiple populations">
<meta name="robots" content="noindex">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">epidemics</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/epidemics.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling interventions</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_interventions.html">Getting started with modelling interventions targeting social contacts</a></li>
    <li><a class="dropdown-item" href="../articles/modelling_multiple_interventions.html">Modelling overlapping and sequential interventions targeting social contacts</a></li>
    <li><a class="dropdown-item" href="../articles/modelling_rate_interventions.html">Modelling interventions that change infection parameters</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling vaccination</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_vaccination.html">Modelling the effect of a vaccination campaign</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling seasonality</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_time_dependence.html">Modelling time-dependence and seasonality in transmission dynamics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Run models with multiple populations</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_populations.html">Modelling in multiple populations</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced modelling</h6></li>
    <li><a class="dropdown-item" href="../articles/modelling_param_uncertainty.html">Modelling parameter uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/modelling_scenarios.html">Modelling intervention scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/finalsize_comparison.html">Reducing parameters required for final size estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides to library models</h6></li>
    <li><a class="dropdown-item" href="../articles/model_vacamole.html">Modelling leaky vaccination and hospitalisation outcomes with Vacamole</a></li>
    <li><a class="dropdown-item" href="../articles/model_ebola.html">Modelling responses to a stochastic Ebola virus epidemic</a></li>
    <li><a class="dropdown-item" href="../articles/model_diphtheria.html">Modelling a diphtheria outbreak in a humanitarian camp setting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides for developers</h6></li>
    <li><a class="dropdown-item" href="../articles/design-principles.html">Design principles for epidemics</a></li>
    <li><a class="dropdown-item" href="../articles/developer-walkthrough.html">Guide to developing epidemics features</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/epidemics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Modelling in multiple populations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/epidemics/blob/main/vignettes/modelling_populations.Rmd" class="external-link"><code>vignettes/modelling_populations.Rmd</code></a></small>
      <div class="d-none name"><code>modelling_populations.Rmd</code></div>
    </div>

    
    
<div class="alert alert-warning">
<p><strong>New to <em>epidemics</em>?</strong> It may help to read the <a href="epidemics.html">“Get started”</a> vignette first!</p>
</div>
<p>This vignette shows how <em>epidemics</em> can be used to combine multiple age-stratified populations into an epidemic model.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/epidemics" class="external-link">epidemics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</details><div class="section level2">
<h2 id="combining-two-populations">Combining two populations<a class="anchor" aria-label="anchor" href="#combining-two-populations"></a>
</h2>
<p>We prepare two age-stratified populations: one using the contact data and demography from the UK, and the other using the contact data and demography from Germany. The epidemiological compartments match the default epidemic model (SEIR-V).</p>
<p>We assume that one in every million people has been infected and is infectious in the United Kingdom, while all the population in Germany is susceptible.</p>
<p>The code for these steps is similar to that in the <a href="epidemics.html">“Getting started vignette”</a>.</p>
<p>First, we define the contact data, demography, and set initial conditions for the first population, and create the corresponding population object.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load contact and population data from socialmixr::polymod</span></span>
<span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va"><a href="https://epiforecasts.io/socialmixr/reference/polymod.html" class="external-link">polymod</a></span></span>
<span></span>
<span><span class="va">contact_data1</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">contact_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span></span>
<span><span class="co"># prepare contact matrix</span></span>
<span><span class="va">contact_matrix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">contact_data1</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare the demography vector</span></span>
<span><span class="va">demography_vector1</span> <span class="op">&lt;-</span> <span class="va">contact_data1</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">demography_vector1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contact_matrix1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view contact matrix and demography</span></span>
<span><span class="va">contact_matrix1</span></span>
<span><span class="co">#&gt;                  age.group</span></span>
<span><span class="co">#&gt; contact.age.group   [0,20)  [20,40)      40+</span></span>
<span><span class="co">#&gt;           [0,20)  7.883663 2.794154 1.565665</span></span>
<span><span class="co">#&gt;           [20,40) 3.120220 4.854839 2.624868</span></span>
<span><span class="co">#&gt;           40+     3.063895 4.599893 5.005571</span></span>
<span></span>
<span><span class="va">demography_vector1</span></span>
<span><span class="co">#&gt;   [0,20)  [20,40)      40+ </span></span>
<span><span class="co">#&gt; 14799290 16526302 28961159</span></span></code></pre></div>
</details><details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initial conditions</span></span>
<span><span class="va">initial_i</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span><span class="va">initial_condition1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">initial_i</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="va">initial_i</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build for all age groups</span></span>
<span><span class="va">initial_conditions1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">initial_condition1</span>,</span>
<span>  <span class="va">initial_condition1</span>,</span>
<span>  <span class="va">initial_condition1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign rownames for clarity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">initial_conditions1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contact_matrix1</span><span class="op">)</span></span></code></pre></div>
</details><details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">population1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"UK"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix1</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector1</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions1</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>Then, we define the contact data, demography, and initial conditions for the second population, and create the corresponding population object.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_data2</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">contact_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"Germany"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing participants without age information. To change this behaviour, set the 'missing.participant.age' option</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="va">contact_matrix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">contact_data2</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">demography_vector2</span> <span class="op">&lt;-</span> <span class="va">contact_data2</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">demography_vector2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contact_matrix2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build for all age groups</span></span>
<span><span class="va">initial_condition2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial_conditions2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">initial_condition2</span>,</span>
<span>  <span class="va">initial_condition2</span>,</span>
<span>  <span class="va">initial_condition2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">population2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Germany"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix2</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector2</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>We define <code>prop_matrix</code>, the connectivity matrix between the two populations (United Kingdom and Germany). In this first example, the rate of connections between the population is 5% that of the rate of connection in each population.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set connectivity matrix between population1 and population2</span></span>
<span><span class="va">prop_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</details><p>We then use the function <code>combine_populations</code> to combine the two populations. The resulting population object will contain 6 strata (3 age groups in each population). If the method is defined as <code>"linear"</code>, the contact rate between groups is computed as the product between the contact matrix between groups and the connectivity between populations.</p>
<div class="section level3 alert alert-info">
<h3 id="note-on-connectivity-matrix">Note on connectivity matrix<a class="anchor" aria-label="anchor" href="#note-on-connectivity-matrix"></a>
</h3>
<p>The contact matrix element of the combined population contains the number of connections between each group of all the populations listed in the <code>populations</code> argument. More than two populations can be combined, and the populations should all contain the same demographic groups. The number of contacts between groups from the same populations is computed from the <code>contact_matrix</code>. The number of contacts between groups from different populations is computed from the <code>connectivity_matrix</code> argument. Different methods can be used to compute the number of contacts between groups from different populations. If <code>method</code> is linear, the number of contacts between groups of different population is computed as the product of the connectivity between the two populations (in <code>connectivity_matrix</code>) and the number of contacts between groups in the population of origin.</p>
</div>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine populations</span></span>
<span><span class="va">tot_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine_populations.html">combine_populations</a></span><span class="op">(</span></span>
<span>  populations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">population1</span>, <span class="va">population2</span><span class="op">)</span>,</span>
<span>  connectivity_matrix <span class="op">=</span> <span class="va">prop_matrix</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"linear"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"combine"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tot_population</span><span class="op">$</span><span class="va">contact_matrix</span></span>
<span><span class="co">#&gt;                 UK_[0,20) UK_[20,40)     UK_40+ Germany_[0,20) Germany_[20,40)</span></span>
<span><span class="co">#&gt; UK_[0,20)       7.8836634  2.7941543 1.56566491     0.21987654       0.0745734</span></span>
<span><span class="co">#&gt; UK_[20,40)      3.1202198  4.8548387 2.62486789     0.09659556       0.2112342</span></span>
<span><span class="co">#&gt; UK_40+          3.0638950  4.5998927 5.00557103     0.12694135       0.1652582</span></span>
<span><span class="co">#&gt; Germany_[0,20)  0.3941832  0.1397077 0.07828325     4.39753086       1.4914680</span></span>
<span><span class="co">#&gt; Germany_[20,40) 0.1560110  0.2427419 0.13124339     1.93191115       4.2246835</span></span>
<span><span class="co">#&gt; Germany_40+     0.1531947  0.2299946 0.25027855     2.53882710       3.3051642</span></span>
<span><span class="co">#&gt;                 Germany_40+</span></span>
<span><span class="co">#&gt; UK_[0,20)        0.04774997</span></span>
<span><span class="co">#&gt; UK_[20,40)       0.08052045</span></span>
<span><span class="co">#&gt; UK_40+           0.20370036</span></span>
<span><span class="co">#&gt; Germany_[0,20)   0.95499934</span></span>
<span><span class="co">#&gt; Germany_[20,40)  1.61040905</span></span>
<span><span class="co">#&gt; Germany_40+      4.07400722</span></span></code></pre></div>
</details><p>The object <code>tot_population</code> contains 6 groups: UK population aged 0-20 years old, 20-40 year old, and &gt;40 years old; and German population aged 0-20 years old, 20-40 year old, and &gt;40 years old.</p>
<p>We now use <code>model_default</code> to simulate the epidemic on the combined population for 700 days, with transmission starting in the United Kingdom.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run an epidemic model using `epidemic`</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_default.html">model_default</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">tot_population</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">700</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>We plot the data to observe the number of cases per region and age group. In all age groups, the outbreaks starts and peaks later in Germany than in the United Kingdom.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot figure of epidemic curve</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[_].*"</span>, <span class="st">""</span>, <span class="va">demography_group</span><span class="op">)</span>,</span>
<span>         age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*[_]"</span>, <span class="st">""</span>, <span class="va">demography_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>      y <span class="op">=</span> <span class="va">value</span>,</span>
<span>      col <span class="op">=</span> <span class="va">age</span>,</span>
<span>      linetype <span class="op">=</span> <span class="va">region</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Dark2"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Age"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">600e3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><p><img src="modelling_populations_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="combining-two-populations-using-a-gravity-model">Combining two populations using a gravity model<a class="anchor" aria-label="anchor" href="#combining-two-populations-using-a-gravity-model"></a>
</h2>
<p>When combining populations, the argument method can be set to “gravity” to implement a gravity model instead, using the connectivity matrix as a distance between regions. In this example, the populations are set to 200km away. The connectivity between regions is then computed from the overall number of inhabitants in each region and the distance.</p>
<div class="section level3 unnumbered alert alert-info">
<h3 id="note-on-gravity-connectivity-matrix">Note on gravity connectivity matrix<a class="anchor" aria-label="anchor" href="#note-on-gravity-connectivity-matrix"></a>
</h3>
<p>If <code>method</code> is set to gravity, a gravity model is used to estimate the number of connections between populations. For each population <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, the number of connections is computed as <span class="math inline">\(C_{ij} = \frac{N_i * N_j}{d_{ij}}\)</span>, with <span class="math inline">\(N_i\)</span> and <span class="math inline">\(N_j\)</span> the overall number of inhabitants in each population, and <span class="math inline">\(d_{ij}\)</span> the distance between populations, taken from the <code>connectivity_matrix</code> argument. To avoid large values, <span class="math inline">\(C_{ij}\)</span> is divided by the maximum value of <span class="math inline">\(C\)</span>. The number of contacts between groups from different populations is computed as the product of <span class="math inline">\(\frac{C_ij}{max(C)}\)</span> and the number of contacts between groups in the population of origin.</p>
</div>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, <span class="fl">200</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gravity_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine_populations.html">combine_populations</a></span><span class="op">(</span></span>
<span>  populations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">population1</span>, <span class="va">population2</span><span class="op">)</span>,</span>
<span>  connectivity_matrix <span class="op">=</span> <span class="va">distance_matrix</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"gravity"</span>, name <span class="op">=</span> <span class="st">"combine_gravity"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gravity_population</span><span class="op">$</span><span class="va">contact_matrix</span></span>
<span><span class="co">#&gt;                  UK_[0,20) UK_[20,40)      UK_40+ Germany_[0,20)</span></span>
<span><span class="co">#&gt; UK_[0,20)       7.88366337 2.79415430 1.565664914    0.016230489</span></span>
<span><span class="co">#&gt; UK_[20,40)      3.12021981 4.85483871 2.624867887    0.007130334</span></span>
<span><span class="co">#&gt; UK_40+          3.06389499 4.59989272 5.005571031    0.009370351</span></span>
<span><span class="co">#&gt; Germany_[0,20)  0.02909717 0.01031272 0.005778585    4.397530864</span></span>
<span><span class="co">#&gt; Germany_[20,40) 0.01151617 0.01791833 0.009687912    1.931911151</span></span>
<span><span class="co">#&gt; Germany_40+     0.01130828 0.01697737 0.018474655    2.538827098</span></span>
<span><span class="co">#&gt;                 Germany_[20,40) Germany_40+</span></span>
<span><span class="co">#&gt; UK_[0,20)           0.005504738 0.003524729</span></span>
<span><span class="co">#&gt; UK_[20,40)          0.015592541 0.005943728</span></span>
<span><span class="co">#&gt; UK_40+              0.012198762 0.015036422</span></span>
<span><span class="co">#&gt; Germany_[0,20)      1.491467979 0.954999336</span></span>
<span><span class="co">#&gt; Germany_[20,40)     4.224683544 1.610409054</span></span>
<span><span class="co">#&gt; Germany_40+         3.305164225 4.074007220</span></span></code></pre></div>
</details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run an epidemic model</span></span>
<span><span class="va">output_gravity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_default.html">model_default</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">gravity_population</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">700</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>Given the distance between populations, the rate of connectivity between the two populations is much lower than when we used <code>method = "linear"</code>. Therefore, almost all cases are reported in the United Kingdom, with rare transmission to Germany.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot figure of epidemic curve</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">output_gravity</span>, <span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[_].*"</span>, <span class="st">""</span>, <span class="va">demography_group</span><span class="op">)</span>,</span>
<span>         age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*[_]"</span>, <span class="st">""</span>, <span class="va">demography_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>      y <span class="op">=</span> <span class="va">value</span>,</span>
<span>      col <span class="op">=</span> <span class="va">age</span>,</span>
<span>      linetype <span class="op">=</span> <span class="va">region</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Dark2"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Age"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">600e3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><p><img src="modelling_populations_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
<p>The argument <code>method</code> can also be defined as a function, which will be used to compute the connectivity matrix. Using <code>method = gravity_contact</code> will lead to the same output as <code>method = "gravity"</code>.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravity_pop_with_function</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine_populations.html">combine_populations</a></span><span class="op">(</span></span>
<span>  populations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">population1</span>, <span class="va">population2</span><span class="op">)</span>,</span>
<span>  connectivity_matrix <span class="op">=</span> <span class="va">distance_matrix</span>,</span>
<span>  method <span class="op">=</span> <span class="va">gravity_contact</span>, name <span class="op">=</span> <span class="st">"combine_gravity"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run an epidemic model</span></span>
<span><span class="va">output_gravity_with_function</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_default.html">model_default</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">gravity_pop_with_function</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">700</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check function and "gravity" outputs are the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">output_gravity_with_function</span> <span class="op">==</span> <span class="va">output_gravity</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="combining-n-populations-using-a-gravity-model">Combining n populations using a gravity model<a class="anchor" aria-label="anchor" href="#combining-n-populations-using-a-gravity-model"></a>
</h2>
<p>In this last example, the function <code>combine_population</code> is used to combine more than 2 population objects. First we define a set of population objects, with 0 infected and infectious cases at the start of the simulations.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="va">all_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">all_population</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span></span>
<span>    contact_matrix <span class="op">=</span> <span class="va">contact_matrix1</span>,</span>
<span>    demography_vector <span class="op">=</span> <span class="va">demography_vector1</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span>    initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">1</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">1</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">1</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Region "</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>We then add one last population object to the <code>all_population</code> list, with a few infectious individuals.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_population</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span></span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix1</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector1</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1e-6</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">1e-6</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1e-6</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">1e-6</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1e-6</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">1e-6</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Region "</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p>Each population is placed on a line, with consecutive populations being 150km away (i.e. populations 1 and 2 are 150km away, 1 and 3 are 300km away…).</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distance_matrix_n</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">150</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">distance_matrix_n</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    0  150  300  450</span></span>
<span><span class="co">#&gt; [2,]  150    0  150  300</span></span>
<span><span class="co">#&gt; [3,]  300  150    0  150</span></span>
<span><span class="co">#&gt; [4,]  450  300  150    0</span></span></code></pre></div>
</details><p>We combine all populations using a gravity model, and simulate an epidemic using and SEIRV model.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_n_populations</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/combine_populations.html">combine_populations</a></span><span class="op">(</span></span>
<span>    populations <span class="op">=</span> <span class="va">all_population</span>,</span>
<span>    connectivity_matrix <span class="op">=</span> <span class="va">distance_matrix_n</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"gravity"</span>, name <span class="op">=</span> <span class="st">"combine_gravity_n"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># run an epidemic model</span></span>
<span><span class="va">output_gravity_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_default.html">model_default</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">combined_n_populations</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">700</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>The outbreak first peaks in region 4, then in region 3, 2, and 1, with similar number of cases.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">output_gravity_n</span>, <span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[_].*"</span>, <span class="st">""</span>, <span class="va">demography_group</span><span class="op">)</span>,</span>
<span>         age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*[_]"</span>, <span class="st">""</span>, <span class="va">demography_group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">time</span>,</span>
<span>      y <span class="op">=</span> <span class="va">value</span>,</span>
<span>      col <span class="op">=</span> <span class="va">region</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Dark2"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Region"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15e3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Simulation time (days)"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Individuals"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre></div>
</details><p><img src="modelling_populations_files/figure-html/unnamed-chunk-18-1.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pratik Gupte, Rosalind Eggo, Edwin Van Leeuwen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3. Theme provided by <a href="https://github.com/epiverse-trace/epiversetheme" class="external-link">epiversetheme</a> 0.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
